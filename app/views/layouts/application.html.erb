<!DOCTYPE html>
<html>
  <head>
    <title>AdminApp</title>
    <%= Gon::Base.render_data %>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/dataTables.bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.18/js/dataTables.bootstrap.min.js"></script>
    <script src='https://www.google.com/recaptcha/api.js'></script>
    <script src="https://js.pusher.com/4.3/pusher.min.js"></script>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>

  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">WebSiteName</a>
        </div>
        <ul class="nav navbar-nav pull-right">
          <% if user_signed_in? %>

            <% if current_user.is_admin? %>
              <li>
                <%= link_to('All users', home_index_path) %>        
              </li>

              <li>
                <%= link_to('All blogs', list_blogs_home_index_path, method: :get) %>        
              </li>

               <li>
                <%= link_to('All orders', list_orders_path, method: :get) %>        
              </li>
            <%end%>

            
            <% if !current_user.is_blacklisted? %>
              <li><%= link_to('Write blog', new_blog_path) %></li>
              <% if !current_user.is_admin? %>
                <li><%= link_to('Order history', history_orders_path) %></li>
                <li><%= link_to('Place delivery Request', new_order_path) %></li>
              <%end%>
            <%end%>
            
            <li>
              <a href="#">Notification&nbsp;&nbsp;<i class="fa fa-bell"></i></a>
            </li>

            <li>
              <%= link_to('Logout', destroy_user_session_path, method: :delete) %>        
            </li>
          <% else %>
            <li>
              <%= link_to('Login', new_user_session_path)  %>  
            </li>
          <% end %>
        </ul>
      </div>
    </nav>

    <% if notice %>
      <p class="alert alert-success"><%= notice %></p>
    <% end %>
    <% if alert %>
      <p class="alert alert-danger"><%= alert %></p>
    <% end %>
    <%= yield %>
  </body>
</html>

<script>

  // Enable pusher logging - don't include this in production
  Pusher.logToConsole = true;

  var pusher = new Pusher('97632b8a3f6723191389', {
    cluster: 'ap2',
    forceTLS: true
  });

  var channel = pusher.subscribe('my-channel');
  channel.bind('order-update', function(data) {
    alert(JSON.stringify(data));
  });
</script>
